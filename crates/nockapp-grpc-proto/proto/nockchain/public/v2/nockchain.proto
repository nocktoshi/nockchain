// nockchain/public/v2/nockchain.proto

syntax = "proto3";

package nockchain.public.v2;

import "nockchain/common/v1/blockchain.proto";
import "nockchain/common/v1/pagination.proto";
import "nockchain/common/v1/primitives.proto";
import "nockchain/common/v2/blockchain.proto";

service NockchainService {
  rpc WalletGetBalance(WalletGetBalanceRequest)
      returns (WalletGetBalanceResponse);
  rpc WalletSendTransaction(WalletSendTransactionRequest)
      returns (WalletSendTransactionResponse);
  rpc TransactionAccepted(TransactionAcceptedRequest)
      returns (TransactionAcceptedResponse);
  //rpc TransactionConfirmation(TransactionConfirmationRequest)
  //    returns (TransactionConfirmationResponse);
}

message WalletGetBalanceRequest {
  oneof selector {
    common.v1.Base58Pubkey address = 1; // wallet address, a base58-encoded cheetah pubkey
    common.v1.Base58Hash first_name = 2; // tip5 hash identifying the note first-name
  }
  common.v1.PageRequest page = 3;
}

message WalletGetBalanceResponse {
  oneof result {
    common.v2.Balance balance = 1;
    common.v1.ErrorStatus error = 2;
  }
}

message WalletSendTransactionRequest {
  common.v1.Hash tx_id = 1;
  common.v2.RawTransaction raw_tx = 2;
}

message WalletSendTransactionResponse {
  oneof result {
    common.v1.Acknowledged ack = 1;
    common.v1.ErrorStatus error = 2;
  }
}

message TransactionAcceptedRequest {
  common.v1.Base58Hash tx_id = 1;
}

message TransactionAcceptedResponse {
  oneof result {
    bool accepted = 1;
    common.v1.ErrorStatus error = 2;
  }
}

service NockchainBlockService {
  rpc GetBlocks(GetBlocksRequest)
    returns (GetBlocksResponse);
  rpc GetTransactionBlock(GetTransactionBlockRequest)
    returns (GetTransactionBlockResponse);
  rpc GetTransactionDetails(GetTransactionDetailsRequest)
    returns (GetTransactionDetailsResponse);
}

message GetBlocksRequest {
  common.v1.PageRequest page = 1;
}

message GetBlocksResponse {
  oneof result {
    BlocksData blocks = 1;
    common.v1.ErrorStatus error = 2;
  }
}

message BlocksData {
  repeated BlockEntry blocks = 1;
  uint64 current_height = 2;
  common.v1.PageResponse page = 3;
}

message BlockEntry {
  common.v1.Hash block_id = 1;
  uint64 height = 2;
  common.v1.Hash parent = 3;
  uint64 timestamp = 4;
  repeated common.v1.Base58Hash tx_ids = 5;
}

message GetTransactionBlockRequest {
  common.v1.Base58Hash tx_id = 1;
}

message GetTransactionBlockResponse {
  oneof result {
    TransactionBlockData block = 1;
    TransactionPending pending = 2;
    common.v1.ErrorStatus error = 3;
  }
}

message TransactionBlockData {
  common.v1.Hash block_id = 1;
  uint64 height = 2;
  common.v1.Hash parent = 3;
  uint64 timestamp = 4;
}

message TransactionPending {
  // Transaction exists in mempool but not yet in a block
}

message GetTransactionDetailsRequest {
  common.v1.Base58Hash tx_id = 1;
}

message GetTransactionDetailsResponse {
  oneof result {
    TransactionDetails details = 1;
    TransactionPending pending = 2;
    common.v1.ErrorStatus error = 3;
  }
}

message TransactionDetails {
  string tx_id = 1;
  common.v1.Hash block_id = 2;
  uint64 height = 3;
  uint64 timestamp = 4;
  uint64 version = 5;
  uint64 size_bytes = 6;
  common.v1.Nicks total_input = 7;
  common.v1.Nicks total_output = 8;
  common.v1.Nicks fee = 9;
  repeated TransactionInput inputs = 10;
  repeated TransactionOutput outputs = 11;
  common.v1.Hash parent = 12;
}

message TransactionInput {
  string note_name_b58 = 1;
  common.v1.Nicks amount = 2;
  string source_tx_id = 3;
  bool coinbase = 4;
}

message TransactionOutput {
  string note_name_b58 = 1;
  common.v1.Nicks amount = 2;
  string lock_summary = 3;
}
